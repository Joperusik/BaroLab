openapi: 3.1.1

info:
  title: BaroLab API
  version: 0.0.1

servers:
  - url: http://localhost:8080

security:
  - bearerAuth: []


tags:
  - name: Users
  - name: Admins
  - name: Posts
  - name: Comments

paths:
  /login:
    post:
      operationId: login
      security: []
      tags:
        - Users
      requestBody:
        content:
          application/json: 
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenResponse'
        400:
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        500:
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /sign-up:
    post:
      operationId: signUp
      security: []
      tags:
        - Users
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SignUpRequest'
      responses:
        201:
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenResponse'
        400:
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        500:
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /users:
    get:
      operationId: getAllUsers
      summary: Get all Users
      tags:
        - Users
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User'
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        500:
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /user/{userId}:
    get:
      operationId: getUserById
      parameters:
        - $ref: '#/components/parameters/userId'
      summary: Get User by ID
      tags:
        - Users
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User' 
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        404: 
          description: Not Found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /user/{userId}/activate:
    put:
      operationId: activateUser
      parameters:
        - $ref: '#/components/parameters/userId'
      tags:
        - Users
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        400:
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        404:
          description: Not Found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        500:
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /user/{userId}/block:
    put:
      operationId: blockUser
      parameters:
        - $ref: '#/components/parameters/userId'
      tags:
        - Users
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        400:
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        404:
          description: Not Found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        500:
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /user/{userId}/role:
    put:
      operationId: updateUserRole
      parameters:
        - $ref: '#/components/parameters/userId'
      tags:
        - Users
      requestBody:
        content:
          application/json:
            schema:
              type: string
              enum: [ USER, SUPERUSER, ADMIN, SUPER_ADMIN ]
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        400:
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        404:
          description: Not Found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        500:
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /posts:
    post:
      operationId: createPost
      tags:
        - Posts
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreatePostRequest'
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Post'
        400:
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        500:
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    get:
      operationId: getAllPosts
      summary: Get all Posts
      tags:
        - Posts
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Post'
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        500:
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /post/{postId}:
    get:
      operationId: getPostById
      parameters:
        - $ref: '#/components/parameters/postId'
      summary: Get Post by ID
      tags:
        - Posts
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Post' 
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /post/{postId}/activate:
    put:
      operationId: activatePost
      parameters:
        - $ref: '#/components/parameters/postId'
      tags:
        - Posts
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Post'
        400:
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        404:
          description: Not Found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        500:
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /post/{postId}/block:
    put:
      operationId: blockPost
      parameters:
        - $ref: '#/components/parameters/postId'
      tags:
        - Posts
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Post'
        400:
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        404:
          description: Not Found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        500:
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /post/{postId}/comment:
    post:
      operationId: createComment
      parameters:
        - $ref: '#/components/parameters/postId'
      tags:
        - Comments
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateCommentRequest'
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Comment'
        400:
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        500:
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    get:
      operationId: getCommentsByPostId
      parameters:
        - $ref: '#/components/parameters/postId'
      summary: Get all Comments for a Post
      tags:
        - Comments
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Comment'
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        500:
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /post/{postId}/comment/{commentId}:
    get:
      operationId: getCommentById
      parameters:
        - $ref: '#/components/parameters/postId'
        - $ref: '#/components/parameters/commentId'
      summary: Get Comment by ID
      tags:
        - Comments
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Comment'
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /post/{postId}/comment/{commentId}/activate:
    put:
      operationId: activateComment
      parameters:
        - $ref: '#/components/parameters/postId'
        - $ref: '#/components/parameters/commentId'
      tags:
        - Comments
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Comment'
        400:
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        404:
          description: Not Found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        500:
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /post/{postId}/comment/{commentId}/block:
    put:
      operationId: blockComment
      parameters:
        - $ref: '#/components/parameters/postId'
        - $ref: '#/components/parameters/commentId'
      tags:
        - Comments
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Comment'
        400:
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        404:
          description: Not Found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        500:
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'


components:

  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  parameters:
    commentId:
      name: commentId
      in: path
      required: true
      schema:
        type: string 
        format: uuid
      description: Id of Comment

    postId:
      name: postId
      in: path
      required: true
      schema:
        type: string 
        format: uuid
      description: Id of Post

    userId:
      name: userId
      in: path
      required: true
      schema:
        type: string
        format: uuid
      description: ID of the User

  schemas:
    Comment:
      type: object
      required:
        - id
        - post_id
        - user_id
        - author_username
        - body
        - status
        - created_at
        - updated_at
      properties:
        id:
          type: string
          format: uuid
          example: 38ca31a9-a336-4087-ac97-d1ed40a2778e
          readOnly: true
        post_id:
          type: string
          format: uuid
          example: 38ca31a9-a336-4087-ac97-d1ed40a2778e
          readOnly: true
        user_id:
          type: string
          format: uuid
          example: 38ca31a9-a336-4087-ac97-d1ed40a2778e
          readOnly: true
        author_username:
          type: string
          readOnly: true
        body:
          type: string
          example: Something cool maybe
        status:
          type: string 
          enum: [ ACTIVE, BLOCKED ]
          example: ACTIVE
          readOnly: true
        created_at:
          type: string
          format: date-time
          example: 2021-09-20T12:00:00Z
          readOnly: true
        updated_at:
          type: string
          format: date-time
          example: 2021-09-20T13:41:22Z
          readOnly: true

    CreateCommentRequest:
      type: object
      required:
        - body
      properties:
        body:
          type: string
          example: Something cool maybe

    Post:
      type: object
      required:
        - id
        - user_id
        - author_username
        - rating
        - status
        - title
        - content
        - created_at
        - updated_at
      properties:
        id:
          type: string
          format: uuid
          example: 38ca31a9-a336-4087-ac97-d1ed40a2778e
          readOnly: true
        user_id:
          type: string
          format: uuid
          example: 38ca31a9-a336-4087-ac97-d1ed40a2778e
          readOnly: true
        author_username:
          type: string
          readOnly: true
        rating:
          type: integer
          example: 0
          readOnly: true
        status:
          type: string 
          enum: [ ACTIVE, BLOCKED ]
          example: ACTIVE
          readOnly: true
        title:
          type: string
          example: Post name
        content:
          type: string 
          example: content
        created_at:
          type: string
          format: date-time
          example: 2021-09-20T12:00:00Z
          readOnly: true
        updated_at:
          type: string
          format: date-time
          example: 2021-09-20T13:41:22Z
          readOnly: true

    CreatePostRequest:
      type: object
      required:
        - title
        - content
      properties:
        title:
          type: string
          example: Post name
        content:
          type: string
          example: content

    User:
      type: object
      required:
        - id
        - login
        - email
        - username
        - status
        - role
        - created_at
        - updated_at
      properties:
        id:
          type: string
          format: uuid
          example: 38ca31a9-a336-4087-ac97-d1ed40a2778e
          readOnly: true
        login:
          type: string
          example: login
        email:
          type: string
          format: email
          example: test@gmail.com
        username:
          type: string
        status:
          type: string
          enum: [ ACTIVE, BLOCKED ]
          example: ACTIVE
          readOnly: true
        role:
          type: string
          enum: [ USER, SUPERUSER, ADMIN, SUPER_ADMIN ]
          example: USER
        created_at:
          type: string
          format: date-time
          example: 2021-09-20T12:00:00Z
          readOnly: true
        updated_at:
          type: string
          format: date-time
          example: 2021-09-20T13:41:22Z
          readOnly: true

    TokenResponse:
      type: object
      required:
        - token
      properties:
        token:
          type: string
          description: JWT token.
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6Ik

    LoginRequest:
      type: object
      required:
        - login
        - password
      properties:
        login:
          type: string
          example: login
        password:
          type: string
          format: password
          example: qwerty123456

    SignUpRequest:
      type: object
      required:
        - login
        - email
        - username
        - password
      properties:
        login:
          type: string
          example: login
        email:
          type: string
          format: email
          example: user@example.com
        username:
          type: string
        password:
          type: string
          format: password
          example: qwerty123456
          writeOnly: true

    Error:
      type: object
      properties:
        message:
          type: string
          example: Error message.